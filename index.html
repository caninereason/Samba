<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Samba Player</title>
    <script src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.23.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.5.0" ></script>
    <link rel="stylesheet" href="mystyle.css">
    <!-- Add CSS and JavaScript references -->
</head>
<body>
    <section id="section3">
        <select id="firstSelect" onchange="updateSrc(event)" >
            <option value="Avenida.Dida">Avenida.Dida</option>
            <option value="Son.Iniciacion">Son.Iniciacion</option>
            
        </select>
        <select id="secondSelect" onchange="updateSrc(event)" >
            <option value="BaseRitmo">BaseRitmo</option>
            <option value="Corte3.1">Corte3.1</option>
            <option value="Corte3.2">Corte3.2</option>
            <option value="Corte4">Corte4</option>
            <option value="Llamada1">Llamada1</option>
            <!-- Add more options here as needed -->
        </select>
        


    
   
        <p id="title" class="center-bold">Avenida Dida BaseRitmo</p><midi-player id="midiPlayer1" src="Avenida.Dida/BaseRitmo/Avenida.Dida_BaseRitmo.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit" sound-font visualizer="#mypianorollvisualizer1" loop></midi-player>
            <midi-visualizer type="piano-roll" id="mypianorollvisualizer1" src="Avenida.Dida/BaseRitmo/Avenida.Dida_BaseRitmo.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit"></midi-visualizer>
        

    <p class="center-bold">SURDO1</p><midi-player src="Avenida.Dida/BaseRitmo/output_note_35.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit" sound-font visualizer="#mypianorollvisualizer2" loop ></midi-player>
    <midi-visualizer type="piano-roll" src="Avenida.Dida/BaseRitmo/output_note_35.mid" id="mypianorollvisualizer2"  sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit"></midi-visualizer>

    <p class="center-bold">SURDO2</p><midi-player src="Avenida.Dida/BaseRitmo/output_note_36.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit" sound-font visualizer="#mypianorollvisualizer3" loop ></midi-player>
        <midi-visualizer type="piano-roll" id="mypianorollvisualizer3" src="Avenida.Dida/BaseRitmo/output_note_36.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit"></midi-visualizer>
                
    <p class="center-bold">DOBRAS</p><midi-player src="Avenida.Dida/BaseRitmo/output_note_47.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit" sound-font visualizer="#mypianorollvisualizer4" loop></midi-player>
    <midi-visualizer type="piano-roll" id="mypianorollvisualizer4" src="Avenida.Dida/BaseRitmo/output_note_47.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit"></midi-visualizer>
    
    <p class="center-bold">REPIQUE</p><midi-player src="Avenida.Dida/BaseRitmo/output_note_50.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit" sound-font visualizer="#mypianorollvisualizer5" loop></midi-player>
    <midi-visualizer type="piano-roll" id="mypianorollvisualizer5" src="Avenida.Dida/BaseRitmo/output_note_50.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit"></midi-visualizer>
    
    <p class="center-bold">CAJA</p><midi-player src="Avenida.Dida/BaseRitmo/output_note_38.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit" sound-font visualizer="#mypianorollvisualizer6" loop></midi-player>
        <midi-visualizer type="piano-roll" id="mypianorollvisualizer6" src="Avenida.Dida/BaseRitmo/output_note_38.mid" sound-font="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit"></midi-visualizer>
</section>
    <!-- Other code remains unchanged -->
    
    <script>
         window.onload = function() {
        document.getElementById('firstSelect').selectedIndex = 0;
    }
        const mp = document.querySelector('midi-player');
       console.log(mp.duration);
       
        
       const options = {
  'Avenida.Dida': ['BaseRitmo', 'Corte3.1', 'Corte3.2', 'Corte4', 'Llamada1'],
  'Son.Iniciacion': ['BaseRitmo', 'Corte3', 'Entrada.1', 'Entrada.2']
};
 // Initial sources stored in an object
 const initialSources = {
        'mypianorollvisualizer2': 'output_note_35.mid',
        'mypianorollvisualizer3': 'output_note_36.mid',
        'mypianorollvisualizer4': 'output_note_47.mid',
        'mypianorollvisualizer5': 'output_note_50.mid',
        'mypianorollvisualizer6': 'output_note_38.mid',
    };

    // Function to reset the src attributes to the initial values
    function resetSrc() {
        for (const id in initialSources) {
            const element = document.getElementById(id);
            element.setAttribute('src', initialSources[id]);
        }
    }

   

    

    



// This function is for changing the src for a specific midi player and visualizer by ID
function updateSrc(event) {

    
    const changedElementId = event.target.id;
    const select1Value = document.getElementById('firstSelect').value; // corrected to 'firstSelect'
    const select2Value = document.getElementById('secondSelect').value; // corrected to 'secondSelect'
    const newSrc = `${select1Value}/${select2Value}/${select1Value}_${select2Value}.mid`;
    const newText = select1Value + ' ' + select2Value;

// Update the text content of the title paragraph
document.getElementById('title').innerText = newText.replace(/\./g, ' ');


  // Construct the new path
  const newPath =`${select1Value}/${select2Value}`;
    document.getElementById('midiPlayer1').setAttribute('src', newSrc);
    document.getElementById('mypianorollvisualizer1').setAttribute('src', newSrc);
    document.getElementById('firstSelect').addEventListener('change', updateSrc);
document.getElementById('secondSelect').addEventListener('change', updateSrc);
const midiPlayers = document.querySelectorAll('midi-player');
  const midiVisualizers = document.querySelectorAll('midi-visualizer');
  mp.addEventListener('play', function() {
    updateSrc();})
  resetSrc();
  // Update the src attribute for all midi-player and midi-visualizer elements
  midiPlayers.forEach(player => {
      changeSrcPath(newPath, player);
      console.log(player);
  });

  midiVisualizers.forEach(visualizer => {
      changeSrcPath(newPath, visualizer);
      console.log(visualizer);
  });
  if (changedElementId === 'firstSelect') {
    // Get the selected value from the first select
    const firstSelectValue = document.getElementById('firstSelect').value;
            
    // Get the options for the selected value
    const secondSelectOptions = options[firstSelectValue] || [];
            
    // Get the second select element
    const secondSelect = document.getElementById('secondSelect');

    // Clear all existing options
    secondSelect.innerHTML = '';
            
    // Add new options
    secondSelectOptions.forEach(option => {
        const optionElement = document.createElement('option');
        optionElement.value = option;
        optionElement.text = option;
        secondSelect.add(optionElement);
    })

    // Set the selected index to 0
    secondSelect.selectedIndex = 0;
}
}

function changeSrcPath(newPath, element) {
  let currentSrc = element.getAttribute('src');
  
  // If there's no currentSrc, set a default one or handle accordingly
  if (!currentSrc) {
    currentSrc = 'empty.mid'; // set to your default path and file
  }

  let fileName = currentSrc.split('/').pop(); // extract everything after the last '/'
  let newSrc = `${newPath}/${fileName}`;
  element.setAttribute('src', newSrc);
}

// Assume you have an element with the id "myElement"




mp.addEventListener('load', function() {
    let ppts;
    if (mp.duration > 2.8) {
        ppts = 200;
    } else {
        ppts = 400;
    }
    
    mypianorollvisualizer1.config = {
            maxPitch: 80,
            minPitch: 30,
            noteHeight: 5,
            pixelsPerTimeStep: ppts,
            
            
        };
        mypianorollvisualizer2.config = {
            
            noteHeight: 5,
            pixelsPerTimeStep: ppts,
            
            
        };
        mypianorollvisualizer3.config = {
            
            noteHeight: 5,
            pixelsPerTimeStep: ppts,
            
            
        };
        mypianorollvisualizer4.config = {
            
            noteHeight: 5,
            pixelsPerTimeStep:ppts,
            
            
        };
        mypianorollvisualizer5.config = {
            
            noteHeight: 5,
            pixelsPerTimeStep: ppts,
            
            
        };
        mypianorollvisualizer6.config = {
            
            noteHeight: 5,
            pixelsPerTimeStep: ppts,
            
            
        };
        
});


       

       

    </script>
</body>
</html>
